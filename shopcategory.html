<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/shop.css">
    <link rel="stylesheet" href="./assets/css/modal_register_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Shop</title>
</head>
<style>
            .error {
      background-color: rgba(220, 53, 69, 0.1);
      color: red;
      display: block;
    }
        .message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 0.9rem;
      display: none;
    }
    </style>
<body>
    <header>
        <nav class="navbar">
            <div class="logoDiv">
                <a href="./index.html">
                    <img class="logoHeaderSize" src="./assets/img/logo.png" alt="logo">
                </a>
            </div>
            <div class="othercontrols">
                <a href="./index.html">Ana səhifə</a>
                <a href="#">Mağaza</a>
                <a href="./aboutUs.html">Haqqımızda</a>
                <a href="./contact.html">Bizimlə əlaqə</a>
                <a href="./cart.html">
                    <img src="./assets/img/cart.png" alt="cart">
                </a>
                <a href="#">
                    <!-- <img src="./assets/img/language.png" alt="language"> -->
                </a>
                        <div id="authControl">
            <button class="signIn" id="modalPage">Daxil ol</button>
            </div>
            </div>
    
            <div class="overlaytus" id="overlaytus" onclick="closeNav()"></div>
    
            <div id="mySidebar" class="sidebar">
                <a href="javascript:void(0)" class="closebtn_first" onclick="closeNav()">&times;</a>
            
                <div class="sidebar-links">
                    <a href="./index.html">Ana səhifə</a>
                    <a href="#">Mağaza</a>
                    <a href="./aboutUs.html">Haqqımızda</a>
                    <a href="./contact.html">Bizimlə əlaqə</a>
                    <a href="./cart.html">Səbət</a>
                    <br><br>
                
                    <!-- <div class="language-dropdown">
                        <button class="language-btn">
                          <img src="./assets/img/Earth - 3.svg" alt="language">
                          Azərbaycan
                          <img src="./assets/img/CaretDown.svg" alt="arrowdown" class="arrow-icon">
                        </button>
                        <div class="language-menu">
                          <a href="#">English</a>
                          <a href="#">Русский</a>
                          <a href="#">Türkçe</a>
                        </div>
                      </div>
                       -->
                </div>
                
            
<div id="mobileAuthControl">
  <button class="sidebar-button" onclick="document.location='mobile_sing.html'">Qeydiyyatdan keç</button>
</div>
            </div>
            
    
            </div>
             <i onclick="openNav()" id="btnbar"  class="fa-solid fa-bars openbtn "></i>
    
        </nav>
        
        <div id="overlay"></div>
    
        <div id="popUP"  data-aos="zoom-in-up">
            <button class="close-btn" id="closeBtn">&times;</button>
            <img class="ModalLogo" src="./assets/img/logo.png" alt="logoModal">
            <h2>Freshboxa xoş gəlmisiniz!</h2>
    
            <p>Hesab yaradaraq, təkliflərimizdən yararlana bilərsiniz. Daxil olmaq üçün email ünvanınızı və şifrənizi seçin. Hesabınız varsa, daxil olun.</p>
    
            <div class="switchButtons">
                <button class="active" onclick="switchForm('login')">Daxil ol</button>
                <button onclick="switchForm('register')">Qeydiyyat</button>
            </div>
            
            <!-- Registration Form -->
        <div id="registerForm" class="formContainer" style="display:none;">
            <form id="registerFormAction">
                <label for="full_name">Ad və Soyad</label>
                <div><img src="./assets/img/User.png" alt="NameSurname"><input type="text" id="full_name" name="full_name" placeholder="Ad və Soyad" required></div>
                <label for="register_email">Mail adresiniz</label>
                <div><img src="./assets/img/Message.png" alt="mail"><input type="text" id="register_email" name="email" placeholder="E-mail" required></div>
                <label for="register_password">Parol daxil edin</label>
                <div><img src="./assets/img/Lock password.png" alt="password"><input type="password" id="register_password" name="password" placeholder="Parol" required></div>
                <span>Ən az 8 simvildan ibarət olmalıdır</span>
                <input style="cursor: pointer;" type="submit" value="Qeydiyyatdan keç">
            </form>
            <div id="registerMessage" class="message"></div>
        </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="formContainer" style="display:block;">
                <form>
                    <label>Mail adresiniz</label>
                    <div><img src="./assets/img/Message.png" alt="mail"><input type="text" id="email" placeholder="E-mail" required></div>
                    <label>Parol daxil edin</label>
                    <div><img src="./assets/img/Lock password.png" alt="password"><input type="password" id="password" placeholder="Parol" required></div>
                    <span>Ən az 8 simvildan ibarət olmalıdır</span>
                    <input style="cursor: pointer;" type="submit" value="Daxil ol">
                </form>
            </div>
            
            
    
    
    
    
<!--     
            <div class="linesOr"><div class="line"></div>or<div class="line"></div></div>
            <div class="googleButton"><button><img src="./assets/img/c8c3099ebf31fee900c92a985399f3f1.png" alt="google">Google</button></div> -->
        </div>
    
        
    
    
        <div class="textHeadButton">
            <h1>
                Məhsullar
            </h1>
            <p>
                Təzə və keyfiyyətli məhsullarımızı kəşf edin. Filtrlərdən istifadə<br> edərək istədiyiniz məhsulu asanlıqla tapın.
            </p>
        </div>
        
      </header>

             <div class="products-container" id="productList">


                

                        
                </div>
            
        </div> 
      </div>
      <footer>
        <div class="footerLogoText">
            <img class="footerLogoSize" src="./assets/img/logo.png" alt="footerLogo">
            <p>Gündəlik Ehtiyaclarınıza Cavab Verən Zəngin<br> Məhsul Seçimi</p>
        </div>
        <div class="infoFooter">
            <div class="socialIconsLinks">
                <span>Sosial media</span>
                <div class="oneLevelmgText"><a href="#"><img src="./assets/img/lin.png" alt="linkedin">Linkedln</a></div>
                <div class="oneLevelmgText"><a href="https://www.instagram.com/freshbox.az/" target="_blank"><img src="./assets/img/InstagramLogo.png" alt="instagram">Instagram</a></div>
                <div class="oneLevelmgText"><a href="https://www.facebook.com/people/Freshbox/61564707001165/" target="_blank"><img src="./assets/img/FacebookLogo.png" alt="facebook">Facebook</a></div>
            </div>
            <div class="numberMail">
                <span>Əlaqə</span>
                <div><a href="tel:+994 51 505 65 95">+994 51 505 65 95</a></div>
                <div><a href="mailto:mobilingo@gmail.com">test@gmail.com</a></div>
            </div>
        </div>
    
      </footer>
        <div class="underFooter">
            <div class="line"></div>
            <span>Freshbox©agentliyi 2025dən bəri. Bütün hüquqlar qorunur.</span>
        </div>

            <!-- <script src="./assets/scripts/index.js"></script> -->
            <script src="./assets/scripts/aboutUs.js"></script>
            <!-- <script src="./assets/scripts/shop.js"></script> -->
<script>
AOS.init();


</script>

<script>
// URL-dən categoryTitle oxuyan funksiya
function getCategoryTitleFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get('categoryTitle');
}

function showToast(message, isError = false) {
  // (sənin verdiyin showToast funksiyası)
}

// Məhsulları göstərmək üçün funksiya
function displayProducts(products) {
  const container = document.getElementById('productList');
  if (!container) {
    console.error("productList elementi tapılmadı");
    return;
  }
  container.innerHTML = '';

  products.forEach(product => {
    const productCardHTML = `
      <div class="products-card" data-id="${product.id}" data-fav="${product.fav || '0'}">
        <div class="imgae-circle">
          <div class="image-container">
            <img src="https://api.fresback.squanta.az/uploads/product/${product.image}" alt="${product.title}">
          </div>
          <div class="favourite-circle" data-id="${product.id}" data-fav="${product.fav === 1 ? '1' : '0'}">
            <img src="${product.fav === 1 ? './assets/img/orangeHerz.svg' : './assets/img/heart.png'}" alt="fav-icon">
          </div>
        </div>
        <div class="name-weight">
          <h3>${product.title}</h3>
          <span class="stock-status">
            ${product.stock === 1
              ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#4CAF50"/><path d="M7 13l3 3 7-7" stroke="white" stroke-width="2"/></svg> Stokda var`
              : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#F44336"/><path d="M15 9l-6 6M9 9l6 6" stroke="white" stroke-width="2"/></svg> Stokda yoxdur`}
          </span>
          <span>${product.quantity > 0 ? product.quantity + ' ədəd' : ''}</span>
          <span>${product.weight > 0 ? product.weight + " kg" : ""}</span>
          <span>${product.liter > 0 ? product.liter + " l" : ""}</span>
        </div>
        <div class="price">
          <span>${product.price} man</span>
        </div>
        <div>
          <button role="link" class="order-btn" data-product='${encodeURIComponent(JSON.stringify(product))}'>İndi sifariş et</button>
        </div>
      </div>
    `;

    container.insertAdjacentHTML('beforeend', productCardHTML);
  });

  // İndi düymələrə dinləyici əlavə et
  container.querySelectorAll('.order-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const productData = decodeURIComponent(e.currentTarget.getAttribute('data-product'));
      const product = JSON.parse(productData);
      goToProductPage(product);
    });
  });

  attachFavListeners();
}

async function loadProducts() {
  try {
    const categoryTitle = getCategoryTitleFromURL();
    console.log("URL categoryTitle:", categoryTitle);

    const res = await fetch('https://api.fresback.squanta.az/api/product/all');
    if (!res.ok) throw new Error('Məhsullar yüklənə bilmədi');
    let products = await res.json();

    console.log('Gelen products:', products);

    if (categoryTitle) {
      const normalizedCategoryTitle = categoryTitle.toLowerCase().trim();
      products = products.filter(p => p.category_title && p.category_title.toLowerCase().trim() === normalizedCategoryTitle);
    }

    console.log("Filtrlənmiş məhsullar:", products);

    displayProducts(products);

    const quantityElem = document.getElementById('quatity-of-products');
    if (quantityElem) {
      quantityElem.textContent = `${products.length} məhsul`;
    }
  } catch (error) {
    console.error(error);
    const container = document.getElementById('productList');
    if(container) container.innerHTML = '<p>Məhsullar yüklənərkən xəta baş verdi.</p>';
  }
}

function goToProductPage(product) {
  localStorage.setItem("selectedProduct", JSON.stringify(product));
  const titleParam = encodeURIComponent(product.title);
  window.location.href = `product-page.html?title=${titleParam}`;
}

function attachFavListeners() {
  document.querySelectorAll(".favourite-circle").forEach(circle => {
    circle.addEventListener("click", async (e) => {
      e.stopPropagation();

      const productCardElement = e.currentTarget.closest('.products-card');
      const productId = e.currentTarget.getAttribute("data-id");

      if (productCardElement && productId) {
        await toggleFavourite(productId, productCardElement, e.currentTarget);
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', () => {
  loadProducts();
});

</script>

</body>
</html>